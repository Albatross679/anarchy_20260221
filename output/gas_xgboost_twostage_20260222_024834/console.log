============================================================
Two-Stage XGBoost Gas Model — gas_xgboost_twostage
Output: output/gas_xgboost_twostage_20260222_024834
Utility: GAS
Zero threshold: 1e-05
Seed: 42
============================================================

--- Loading Data ---
  Source: data/tree_features_gas_cross.parquet
  Loaded: 751,048 rows, 48 columns
  Buildings: 146
  Dropped 735,556 rows with NaN (97.9%)
  Dataset: 15,492 rows
  Features (42): ['temperature_2m', 'relative_humidity_2m', 'dew_point_2m', 'direct_radiation', 'wind_speed_10m', 'cloud_cover', 'apparent_temperature', 'precipitation', 'floorsaboveground', 'building_age', 'hour_of_day', 'minute_of_hour', 'day_of_week', 'is_weekend', 'energy_lag_4', 'energy_lag_24', 'energy_lag_96', 'energy_lag_672', 'rolling_mean_96', 'rolling_std_96', 'rolling_mean_672', 'rolling_std_672', 'temp_x_area', 'humidity_x_area', 'hdd', 'cdd', 'electricity_concurrent', 'electricity_lag_4', 'electricity_lag_96', 'electricity_rolling_mean_96', 'heat_concurrent', 'heat_lag_4', 'heat_lag_96', 'heat_rolling_mean_96', 'steam_concurrent', 'steam_lag_4', 'steam_lag_96', 'steam_rolling_mean_96', 'cooling_concurrent', 'cooling_lag_4', 'cooling_lag_96', 'cooling_rolling_mean_96']

--- Zero Analysis ---
  Total samples: 15,492
  Zero samples:  15,040 (97.1%)
  Non-zero:      452 (2.9%)

--- Train/Test Split ---
  Train: 6,564 rows | Test: 8,928 rows
  Train on/off: 84 on / 6,480 off
  Test on/off:  368 on / 8,560 off
  Auto scale_pos_weight: 77.14

============================================================
STAGE 1: Training Classifier (on/off)
============================================================
[0]	validation_0-logloss:0.64923	validation_1-logloss:0.65328
[50]	validation_0-logloss:0.06924	validation_1-logloss:0.19032
[100]	validation_0-logloss:0.01213	validation_1-logloss:0.18094
[150]	validation_0-logloss:0.00463	validation_1-logloss:0.19198
[157]	validation_0-logloss:0.00428	validation_1-logloss:0.19306
  Classifier TensorBoard logs: output/gas_xgboost_twostage_20260222_024834/tensorboard

--- Classifier Evaluation ---
  Accuracy:  0.9481
  Precision: 0.1260
  Recall:    0.0435
  F1:        0.0646
  AUC:       0.8729

============================================================
STAGE 2: Training Regressor (non-zero samples)
============================================================
  Non-zero train: 84 rows
  Non-zero test:  368 rows
[0]	validation_0-rmse:0.00003	validation_1-rmse:0.00002
[50]	validation_0-rmse:0.00003	validation_1-rmse:0.00002
  Regressor TensorBoard logs: output/gas_xgboost_twostage_20260222_024834/tensorboard/regressor

--- Regressor Evaluation (non-zero subset) ---
  RMSE:  0.000023
  MAE:   0.000015
  R²:    -0.0303
  MAPE:  49.86%
  Trees: 1

============================================================
COMBINED: Two-Stage Pipeline Evaluation
============================================================
  SHAP plots saved.
  Blending strategies:
    hard (0/1 gate):        R² = -0.1864
    soft (prob * reg):       R² = -0.0998
    optimal (cutoff=0.90):  R² = -0.0517
  Best strategy: optimal_threshold
  Combined R²:   -0.0517
  Combined RMSE: 0.000009
  Combined MAE:  0.000002
  R² (non-zero): -2.6696
  Zero classification accuracy:    0.9870
  Non-zero classification accuracy: 0.0435

--- Saving ---
  Classifier saved: output/gas_xgboost_twostage_20260222_024834/checkpoints/classifier_best.json
  Regressor saved:  output/gas_xgboost_twostage_20260222_024834/checkpoints/regressor_best.json
  Metrics saved: output/gas_xgboost_twostage_20260222_024834/metrics.json
  Predictions saved: output/gas_xgboost_twostage_20260222_024834/predictions.parquet (blend_mode=optimal)

============================================================
Done in 9.7s
Output directory: output/gas_xgboost_twostage_20260222_024834
Combined R²: -0.0517 (vs single-stage 0.65)
============================================================
